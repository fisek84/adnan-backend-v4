services:
  - type: web
    name: adnan-backend-v4
    env: docker
    plan: starter
    region: frankfurt

    dockerfilePath: Dockerfile
    dockerContext: .

    # FORCE CLEAN BUILD EVERY TIME (fix for stale Docker cache)
    buildCommand: |
      docker build --no-cache -t adnan-backend-v4 .

    autoDeploy: true

    # ============================
    # HEALTH CHECK
    # ============================
    healthCheckPath: "/health"
    healthCheckInterval: 30
    healthCheckTimeout: 10     # Render max allowed

    # ============================
    # RUNTIME SETTINGS
    # ============================
    serviceTimeout: 500        # enough for long requests
    numInstances: 1

    resources:
      cpu: 0.5
      memory: 512Mi

    # ============================
    # ENVIRONMENT VARIABLES
    # ============================
    envVars:
      - key: NOTION_API_KEY
        sync: false

      - key: NOTION_GOALS_DB_ID
        sync: false

      - key: NOTION_TASKS_DB_ID
        sync: false

      - key: NOTION_PROJECTS_DB_ID
        sync: false

      - key: NOTION_AGENT_EXCHANGE_DB_ID
        sync: false

      - key: NOTION_AGENT_PROJECTS_DB_ID
        sync: false

    # ============================
    # DEPLOY TRIGGER SETTINGS
    # ============================
    buildFilter:
      paths:
        - Dockerfile
        - requirements.txt
        - render.yaml
        - main.py
        - routers/**
        - services/**
        - models/**
        - ext/**
        - dependencies.py

    autoRetry:
      enabled: true
      maxRetries: 5
      delay: 10
      factor: 2
