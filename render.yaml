services:
  - type: web
    name: adnan-backend-v4
    env: docker
    plan: starter
    region: frankfurt
    autoDeploy: true

    dockerfilePath: Dockerfile
    dockerContext: .

    # ============================
    # HEALTH / READINESS
    # ============================
    healthCheckPath: "/ready"
    healthCheckInterval: 30
    healthCheckTimeout: 10

    # ============================
    # RUNTIME SETTINGS
    # ============================
    numInstances: 1

    resources:
      cpu: 0.5
      memory: 512Mi

    # ============================
    # ENVIRONMENT VARIABLES
    # ============================
    envVars:
      # --- runtime marker (koristiš u kodu da ne load_dotenv na Renderu)
      - key: RENDER
        value: "true"

      # --- OpenAI
      - key: OPENAI_API_KEY
        sync: false

      # --- Notion core
      - key: NOTION_API_KEY
        sync: false

      - key: NOTION_GOALS_DB_ID
        sync: false
      - key: NOTION_TASKS_DB_ID
        sync: false
      - key: NOTION_PROJECTS_DB_ID
        sync: false

      # --- Ops assistant / internal
      - key: NOTION_OPS_ASSISTANT_ID
        sync: false

      # --- Agent registry (opcionalno, ali preporučeno eksplicitno)
      - key: AGENTS_JSON_PATH
        value: "/app/config/agents.json"

      # --- Safety controls (opcionalno)
      - key: OPS_SAFE_MODE
        value: "false"
      - key: CEO_TOKEN_ENFORCEMENT
        value: "false"
      # - key: CEO_APPROVAL_TOKEN
      #   sync: false  # set only if CEO_TOKEN_ENFORCEMENT=true

      # --- OS switch (opcionalno)
      - key: OS_ENABLED
        value: "true"

    # ============================
    # DEPLOY TRIGGER SETTINGS
    # ============================
    buildFilter:
      paths:
        - Dockerfile
        - requirements.txt
        - render.yaml
        - main.py
        - gateway/**
        - routers/**
        - services/**
        - models/**
        - ext/**
        - dependencies.py
        - config/**

    autoRetry:
      enabled: true
      maxRetries: 5
      delay: 10
      factor: 2
