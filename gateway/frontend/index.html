<!DOCTYPE html>
<html lang="bs">
<head>
  <meta charset="UTF-8" />
  <title>Adnan.AI / Evolia OS — CEO Control Center</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/static/style.css" />

  <!-- 1-screen layout + fixed left chat, right-side internal scroll -->
  <style>
    html, body { height: 100%; }
    body { overflow: hidden; }

    .app-shell {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* Glavni grid: dvije kolone, jedan red fiksiran na visinu ekrana */
    .layout{
      flex: 1;
      min-height: 0;
      display: grid;
      grid-template-columns: 0.88fr 1.12fr;
      grid-template-rows: minmax(0, 1fr); /* ključ: red je tačno visine raspoloživog prostora */
      gap: 14px;
      padding: 14px 14px 10px;
      overflow: hidden; /* nema page scrolla, samo interni */
    }

    /* Kolone su flex stupci sa internim scrollom po potrebi */
    .column{
      min-height: 0;
      display: flex;
      flex-direction: column;
      gap: 14px;
    }
    .column-left{
      overflow: hidden;        /* chat box mora ostati unutar kolone */
    }
    .column-right{
      overflow-y: auto;        /* desna kolona scrolla kad je viša od ekrana */
    }

    /* Lijeva CEO kartica = full-height container za chat */
    .card-command{
      flex: 1;
      min-height: 0;
      display: flex;
      flex-direction: column;
    }
    .command-layout{
      flex: 1;
      min-height: 0;
      display: flex;
      flex-direction: column;
    }

    /* Tablice desno: ~5 redova pa scroll (zadržavamo tvoj behaviour) */
    .table-wrapper-compact {
      max-height: 300px;
      overflow: auto;
    }
    .table-wrapper-weekly {
      max-height: 340px;
      overflow: auto;
    }
  </style>
</head>

<body>
  <div class="app-shell">
    <!-- TOP BAR -->
    <header class="top-bar">
      <div class="brand">
        <div class="brand-orb"></div>
        <div>
          <div class="brand-title">Adnan.AI / Evolia OS</div>
          <div class="brand-subtitle">CEO Control Center</div>
        </div>
      </div>

      <div class="top-status">
        <span id="os-status-pill" class="status-pill">OS</span>
        <span class="status-pill status-pill-safe">
          GOVERNANCE: WHOLE → BLOCKED → APPROVAL → EXECUTED
        </span>
      </div>
    </header>

    <main class="layout">
      <!-- LEFT COLUMN: CEO CHAT (ChatGPT-style) -->
      <section class="column column-left">
        <section class="card card-command">
          <div class="card-header">
            <div>
              <h2>CEO COMMAND (NL)</h2>
              <p class="card-subtitle">
                CEO → SYSTEM kanal (unos komande). Tok: BLOCKED → APPROVAL → EXECUTED.
              </p>
            </div>
          </div>

          <div class="command-layout">
            <!-- CEO CHATBOX: history scrolla, input pinovan na dnu kartice -->
            <div class="ceo-chatbox" id="ceo-left-panel">
              <!-- HISTORY -->
              <div class="ceo-chat-history" id="ceo-history">
                <div class="ceo-chat-empty">
                  Napiši CEO komandu ispod. History je scroll, input je fiksno na dnu.
                </div>
              </div>

              <!-- COMPOSER (input + dugmad) -->
              <div class="ceo-chat-composer">
                <div class="ceo-composer-shell">
                  <textarea
                    class="ceo-chat-input"
                    id="ceo-command-input"
                    placeholder="Unesi CEO COMMAND...
(Enter = pošalji, Shift+Enter = novi red)"
                  ></textarea>

                  <div class="ceo-chat-actions">
                    <button
                      type="button"
                      class="ceo-btn-approve"
                      id="approve-latest-btn"
                      disabled
                    >
                      Odobri
                    </button>

                    <button
                      type="button"
                      class="ceo-btn-send"
                      id="send-command-btn"
                    >
                      ▶
                    </button>
                  </div>
                </div>

                <!-- Status / meta -->
                <div class="small-muted" style="margin-top:6px; display:flex; gap:8px; flex-wrap:wrap;">
                  <span id="command-status-chip"></span>
                  <span id="command-status-text"></span>
                  <span id="last-execution-state" class="hidden"></span>
                  <span id="last-approval-id" class="hidden"></span>
                </div>
              </div>
            </div>
          </div>

          <pre id="debug-output" class="debug-output hidden"></pre>
        </section>
      </section>

      <!-- RIGHT COLUMN -->
      <section class="column column-right">
        <div class="cards-grid">
          <!-- GOALS -->
          <section class="card">
            <div class="card-header card-header-compact">
              <div>
                <h3>Ciljevi &amp; Podciljevi</h3>
                <p class="card-subtitle">Snapshot iz Notion Goals DB</p>
              </div>
              <div class="pill-group">
                <span class="pill" id="goals-total-pill">Ukupno: –</span>
                <span class="pill pill-accent" id="goals-active-pill">Aktivni: –</span>
              </div>
            </div>

            <div class="table-wrapper table-wrapper-compact">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>Goal</th>
                    <th>Status</th>
                    <th>Priority</th>
                    <th>Deadline</th>
                  </tr>
                </thead>
                <tbody id="goals-table-body">
                  <tr>
                    <td colspan="4" class="placeholder-text">Učitavanje ciljeva...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </section>

          <!-- TASKS -->
          <section class="card">
            <div class="card-header card-header-compact">
              <div>
                <h3>Taskovi</h3>
                <p class="card-subtitle">Aktivni operativni zadaci</p>
              </div>
              <div class="pill-group">
                <span class="pill" id="tasks-total-pill">Ukupno: –</span>
                <span class="pill pill-accent" id="tasks-active-pill">Aktivni: –</span>
              </div>
            </div>

            <div class="table-wrapper table-wrapper-compact">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>Task</th>
                    <th>Status</th>
                    <th>Priority</th>
                    <th>Due date</th>
                  </tr>
                </thead>
                <tbody id="tasks-table-body">
                  <tr>
                    <td colspan="4" class="placeholder-text">Učitavanje taskova...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </section>
        </div>

        <!-- PIPELINE SNAPSHOT -->
        <section class="card">
          <div class="card-header card-header-compact">
            <div>
              <h3>Odobrenje cjevovoda</h3>
              <p class="card-subtitle">WHOLE → BLOCKED → APPROVAL → EXECUTED</p>
            </div>
          </div>

          <div class="pipeline-row">
            <div class="pipeline-stage">
              <span class="stage-label">Pending</span>
              <div class="stage-value" id="pending-count-pill">0</div>
            </div>
            <div class="pipeline-stage">
              <span class="stage-label">Odobreno danas</span>
              <div class="stage-value" id="approved-today-pill">0</div>
            </div>
            <div class="pipeline-stage">
              <span class="stage-label">Ukupno izvršeno</span>
              <div class="stage-value" id="executed-total-pill">0</div>
            </div>
            <div class="pipeline-stage">
              <span class="stage-label">Greške</span>
              <div class="stage-value" id="errors-total-pill">0</div>
            </div>
          </div>

          <div class="pipeline-list-wrapper">
            <div class="pipeline-list-header">
              <span>Pending zahtjevi</span>
              <span id="pending-label" class="small-muted">–</span>
            </div>
            <ul id="pending-approvals-list" class="pipeline-list">
              <li class="placeholder-text">Trenutno nema zahtjeva na čekanju.</li>
            </ul>
          </div>
        </section>

        <!-- WEEKLY PRIORITY TABLE -->
        <section class="card">
          <div class="card-header card-header-compact">
            <div>
              <h3>Weekly Priority</h3>
              <p class="card-subtitle">Lista iz AI Summary DB (Notion)</p>
            </div>
            <button id="refresh-weekly-btn" class="btn btn-ghost" type="button">Osvježi listu</button>
          </div>

          <div class="table-wrapper table-wrapper-weekly">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Tip</th>
                  <th>Naziv</th>
                  <th>Status</th>
                  <th>Prioritet</th>
                  <th>Period</th>
                </tr>
              </thead>
              <tbody id="weekly-priority-body">
                <tr>
                  <td colspan="5" class="placeholder-text">Učitavanje liste...</td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="footer-hint small-muted" id="weekly-priority-footer"></div>
        </section>
      </section>
    </main>

    <footer class="footer">
      <span>Adnan.AI / Evolia OS · CEO cockpit</span>
      <span id="footer-status" class="small-muted"></span>
    </footer>
  </div>

  <!-- Samo stari script.js koji koristi postojeće ID-eve -->
  <script src="/static/script.js" defer></script>
</body>
</html>
